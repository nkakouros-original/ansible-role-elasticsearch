---

# Elasticsearch configuration defaults
_elastic_config_defaults:
  http:
    host: "{{ elastic_bind_host }}"
    port: "{{ elastic_bind_port }}"
  transport:
    host: "{{ elastic_transport_host }}"
  cluster: >-
    {% if elastic_discovery_type == 'single-node' -%}
      {{ {"name": elastic_cluster_name} }}
    {% else -%}
      {{
        {
          "name": elastic_cluster_name,
          "initial_master_nodes": elastic_cluster_initial_master_nodes
        }
      }}
    {%- endif %}
  node:
    name: "{{ elastic_node_name }}"
    master: "{{ elastic_master_node }}"
    data: "{{ elastic_data_node }}"
    ingest: "{{ elastic_ingest_node }}"
  discovery:
    seed_providers: "{{ elastic_discovery_seed_providers }}"
    seed_hosts: "{{ elastic_discovery_seed_hosts }}"
    type: "{{ elastic_discovery_type }}"
  path:
    data: /var/lib/elasticsearch
    logs: /var/log/elasticsearch
  xpack:
    security:
      enabled: true

_elastic_certificates_ca_command: >-
  /usr/share/elasticsearch/bin/elasticsearch-certutil
    ca
    --silent
    --pem
    --out /etc/elasticsearch/certs/elastic-stack-ca.zip
    {{ '--pass ' + elastic_certificates_password
        if elastic_certificates_password != None else '' }}

_elastic_certificates_cert_command: >-
  /usr/share/elasticsearch/bin/elasticsearch-certutil
    {{ elastic_certificates_generate_csr | ternary('csr', 'cert') }}
    --silent
    --pem
    --in /etc/elasticsearch/certs/elasticsearch-certutil.yml
    --out /etc/elasticsearch/certs/elasticsearch-certs.zip
    --ca-cert /etc/elasticsearch/certs/ca/ca.crt
    --ca-key /etc/elasticsearch/certs/ca/ca.key
    {{ '--ca-pass ' + elastic_certificates_password
        if elastic_certificates_password != None else '' }}
    {{ '--pass ' + elastic_certificates_password
        if elastic_certificates_password != None else '' }}
